<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI íŒ¨ì…˜ ë¶„ì„ê¸°</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(45deg, #ff6b6b, #ee5a52);
            color: white;
            padding: 40px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
            margin-bottom: 15px;
        }

        .ai-status {
            background: rgba(255, 255, 255, 0.2);
            padding: 10px 20px;
            border-radius: 25px;
            display: inline-block;
            font-size: 0.9rem;
        }

        .main-content {
            padding: 40px;
        }

        .upload-section {
            text-align: center;
            margin-bottom: 30px;
        }

        .upload-area {
            border: 3px dashed #ddd;
            border-radius: 15px;
            padding: 60px 20px;
            margin-bottom: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: #fafafa;
        }

        .upload-area:hover {
            border-color: #ff6b6b;
            background: #fff5f5;
        }

        .upload-area.dragover {
            border-color: #ff6b6b;
            background: #fff5f5;
            transform: scale(1.02);
        }

        .upload-icon {
            font-size: 4rem;
            color: #ddd;
            margin-bottom: 20px;
        }

        .upload-area:hover .upload-icon {
            color: #ff6b6b;
        }

        .upload-text {
            font-size: 1.2rem;
            color: #666;
            margin-bottom: 10px;
        }

        .upload-subtext {
            color: #999;
            font-size: 0.9rem;
        }

        .file-input {
            display: none;
        }

        .btn {
            background: linear-gradient(45deg, #ff6b6b, #ee5a52);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 50px;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(238, 90, 82, 0.3);
        }

        .preview-section {
            display: none;
            margin-bottom: 30px;
        }

        .preview-image {
            max-width: 100%;
            max-height: 400px;
            border-radius: 15px;
            margin: 20px auto;
            display: block;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .analyzing-section {
            display: none;
            text-align: center;
            padding: 40px;
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            border-radius: 15px;
            margin-bottom: 30px;
            color: white;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid rgba(255, 255, 255, 0.3);
            border-top: 5px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        .ad-space {
            background: rgba(255, 255, 255, 0.2);
            border: 2px dashed rgba(255, 255, 255, 0.3);
            padding: 30px;
            text-align: center;
            margin: 20px 0;
            border-radius: 10px;
            color: white;
            font-size: 1rem;
        }

        .results-section {
            display: none;
        }

        .score-display {
            text-align: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            border-radius: 15px;
            margin-bottom: 30px;
        }

        .total-score {
            font-size: 4rem;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .score-label {
            font-size: 1.3rem;
            opacity: 0.9;
        }

        .analysis-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .analysis-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            border-left: 5px solid;
        }

        .analysis-card h3 {
            margin-bottom: 15px;
            font-size: 1.2rem;
        }

        .analysis-card .score {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .color-harmony {
            border-left-color: #ff6b6b;
        }

        .fit-style {
            border-left-color: #4ecdc4;
        }

        .trend-factor {
            border-left-color: #45b7d1;
        }

        .overall-balance {
            border-left-color: #96ceb4;
        }

        .color-harmony h3,
        .color-harmony .score {
            color: #ff6b6b;
        }

        .fit-style h3,
        .fit-style .score {
            color: #4ecdc4;
        }

        .trend-factor h3,
        .trend-factor .score {
            color: #45b7d1;
        }

        .overall-balance h3,
        .overall-balance .score {
            color: #96ceb4;
        }

        .feedback-section {
            background: #f8f9fa;
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
        }

        .feedback-title {
            text-align: center;
            font-size: 1.5rem;
            margin-bottom: 20px;
            color: #333;
        }

        .feedback-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .feedback-item {
            text-align: center;
            padding: 15px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .feedback-buttons {
            display: flex;
            gap: 5px;
            justify-content: center;
            margin-top: 10px;
            flex-wrap: wrap;
        }

        .feedback-btn {
            padding: 8px 12px;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: all 0.3s ease;
            min-width: 60px;
        }

        .feedback-btn.high {
            background: #dc3545;
            color: white;
        }

        .feedback-btn.accurate {
            background: #6c757d;
            color: white;
        }

        .feedback-btn.low {
            background: #28a745;
            color: white;
        }

        .feedback-btn:hover {
            transform: scale(1.05);
        }

        .feedback-btn.selected {
            transform: scale(1.1);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .overall-feedback {
            text-align: center;
            margin-top: 25px;
            padding-top: 25px;
            border-top: 2px solid #ddd;
        }

        .rating-stars {
            font-size: 2rem;
            margin: 10px 0;
        }

        .star {
            cursor: pointer;
            color: #ddd !important;
            transition: color 0.2s;
            margin: 0 2px;
        }

        .star.selected {
            color: #ffc107 !important;
        }

        .star:hover {
            color: #ffc107 !important;
        }

        .reset-btn {
            background: #6c757d;
            margin-top: 20px;
        }

        .reset-btn:hover {
            background: #5a6268;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }

            .main-content {
                padding: 20px;
            }

            .total-score {
                font-size: 3rem;
            }

            .feedback-buttons {
                flex-direction: column;
                gap: 8px;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ¤– AI íŒ¨ì…˜ ë¶„ì„ê¸°</h1>
            <p>ë‹¹ì‹ ì˜ íŒ¨ì…˜ ì„¼ìŠ¤ë¥¼ AIê°€ ì •í™•í•˜ê²Œ ë¶„ì„í•´ë“œë¦½ë‹ˆë‹¤</p>
            <div class="ai-status">
                âœ¨ ì‚¬ìš©ìê°€ ë§ì„ìˆ˜ë¡ AIì˜ ì •í™•ë„ê°€ ì§„í™”í•©ë‹ˆë‹¤!
            </div>
        </div>

        <div class="main-content">
            <div class="upload-section" id="uploadSection">
                <div class="upload-area" id="uploadArea">
                    <div class="upload-icon">ğŸ“·</div>
                    <div class="upload-text">íŒ¨ì…˜ ì‚¬ì§„ì„ ì—…ë¡œë“œí•˜ì„¸ìš”</div>
                    <div class="upload-subtext">AIê°€ ë‹¹ì‹ ì˜ ìŠ¤íƒ€ì¼ì„ ë¶„ì„í•©ë‹ˆë‹¤</div>
                </div>
                <input type="file" id="fileInput" class="file-input" accept="image/*">
                <button class="btn" onclick="document.getElementById('fileInput').click()">
                    ğŸ“ íŒŒì¼ ì„ íƒí•˜ê¸°
                </button>
            </div>

            <div class="preview-section" id="previewSection">
                <h3 style="text-align: center; margin-bottom: 20px;">ì—…ë¡œë“œëœ ì´ë¯¸ì§€</h3>
                <img id="previewImage" class="preview-image" src="" alt="ë¯¸ë¦¬ë³´ê¸°">
                <div style="text-align: center; margin-top: 20px;">
                    <button class="btn" onclick="startAnalysis()">ğŸ§  AI ë¶„ì„ ì‹œì‘</button>
                </div>
            </div>

            <div class="analyzing-section" id="analyzingSection">
                <div class="spinner"></div>
                <h3>AIê°€ íŒ¨ì…˜ ìš”ì†Œë¥¼ ë¶„ì„ì¤‘ì…ë‹ˆë‹¤...</h3>
                <p id="analysisStatus">ìƒ‰ìƒ íŒ¨í„´ ë¶„ì„ ì§„í–‰ ì¤‘...</p>

                <div class="ad-space">
                    ğŸ’° ê´‘ê³  ê³µê°„ ğŸ’°<br>
                    AIê°€ ë¶„ì„í•˜ëŠ” ë™ì•ˆ ì ì‹œ íœ´ì‹ì„ ì·¨í•˜ì„¸ìš”!<br>
                    <small>(Google AdSense, íŒ¨ì…˜ ë¸Œëœë“œ ê´‘ê³  ë“±)</small>
                </div>
            </div>

            <div class="results-section" id="resultsSection">
                <div class="score-display">
                    <div class="total-score" id="totalScore">85</div>
                    <div class="score-label">ì¢…í•© íŒ¨ì…˜ ì ìˆ˜</div>
                </div>

                <div class="analysis-grid">
                    <div class="analysis-card color-harmony">
                        <h3>ğŸ¨ ìƒ‰ìƒ ì¡°í™”</h3>
                        <div class="score" id="colorScore">78</div>
                        <p id="colorAnalysis">AIê°€ ë¶„ì„í•œ ìƒ‰ìƒ ì¡°í™”ë„ì…ë‹ˆë‹¤.</p>
                    </div>

                    <div class="analysis-card fit-style">
                        <h3>ğŸ‘” ì²´í˜•ê³¼ í•</h3>
                        <div class="score" id="fitScore">88</div>
                        <p id="fitAnalysis">ì²´í˜• ì í•©ì„±ì„ AIê°€ ë¶„ì„í–ˆìŠµë‹ˆë‹¤.</p>
                    </div>

                    <div class="analysis-card trend-factor">
                        <h3>ğŸ“ˆ íŠ¸ë Œë“œ ë°˜ì˜</h3>
                        <div class="score" id="trendScore">82</div>
                        <p id="trendAnalysis">ìµœì‹  íŠ¸ë Œë“œ ë°ì´í„° ê¸°ë°˜ ë¶„ì„ì…ë‹ˆë‹¤.</p>
                    </div>

                    <div class="analysis-card overall-balance">
                        <h3>âš–ï¸ ì „ì²´ ê· í˜•</h3>
                        <div class="score" id="balanceScore">90</div>
                        <p id="balanceAnalysis">ì¢…í•©ì ì¸ íŒ¨ì…˜ ë°¸ëŸ°ìŠ¤ ì ìˆ˜ì…ë‹ˆë‹¤.</p>
                    </div>
                </div>

                <!-- í”¼ë“œë°± ì„¹ì…˜ -->
                <div class="feedback-section">
                    <h3 class="feedback-title">ğŸ¯ ë¶„ì„ ê²°ê³¼ê°€ ì •í™•í•œê°€ìš”?</h3>
                    <p style="text-align: center; margin-bottom: 20px; color: #666;">
                        ë‹¹ì‹ ì˜ í”¼ë“œë°±ì´ AIë¥¼ ë” ì •í™•í•˜ê²Œ ë§Œë“­ë‹ˆë‹¤
                    </p>

                    <div class="feedback-grid">
                        <div class="feedback-item">
                            <h4>ìƒ‰ìƒ ì¡°í™”</h4>
                            <div class="score" style="color: #ff6b6b;" id="feedbackColorScore">78</div>
                            <div class="feedback-buttons">
                                <button class="feedback-btn high" data-category="color" data-feedback="high">ì ìˆ˜
                                    ë†’ìŒ</button>
                                <button class="feedback-btn accurate" data-category="color"
                                    data-feedback="accurate">ì •í™•í•¨</button>
                                <button class="feedback-btn low" data-category="color" data-feedback="low">ì ìˆ˜
                                    ë‚®ìŒ</button>
                            </div>
                        </div>

                        <div class="feedback-item">
                            <h4>ì²´í˜•ê³¼ í•</h4>
                            <div class="score" style="color: #4ecdc4;" id="feedbackFitScore">88</div>
                            <div class="feedback-buttons">
                                <button class="feedback-btn high" data-category="fit" data-feedback="high">ì ìˆ˜
                                    ë†’ìŒ</button>
                                <button class="feedback-btn accurate" data-category="fit"
                                    data-feedback="accurate">ì •í™•í•¨</button>
                                <button class="feedback-btn low" data-category="fit" data-feedback="low">ì ìˆ˜ ë‚®ìŒ</button>
                            </div>
                        </div>

                        <div class="feedback-item">
                            <h4>íŠ¸ë Œë“œ ë°˜ì˜</h4>
                            <div class="score" style="color: #45b7d1;" id="feedbackTrendScore">82</div>
                            <div class="feedback-buttons">
                                <button class="feedback-btn high" data-category="trend" data-feedback="high">ì ìˆ˜
                                    ë†’ìŒ</button>
                                <button class="feedback-btn accurate" data-category="trend"
                                    data-feedback="accurate">ì •í™•í•¨</button>
                                <button class="feedback-btn low" data-category="trend" data-feedback="low">ì ìˆ˜
                                    ë‚®ìŒ</button>
                            </div>
                        </div>

                        <div class="feedback-item">
                            <h4>ì „ì²´ ê· í˜•</h4>
                            <div class="score" style="color: #96ceb4;" id="feedbackBalanceScore">90</div>
                            <div class="feedback-buttons">
                                <button class="feedback-btn high" data-category="balance" data-feedback="high">ì ìˆ˜
                                    ë†’ìŒ</button>
                                <button class="feedback-btn accurate" data-category="balance"
                                    data-feedback="accurate">ì •í™•í•¨</button>
                                <button class="feedback-btn low" data-category="balance" data-feedback="low">ì ìˆ˜
                                    ë‚®ìŒ</button>
                            </div>
                        </div>
                    </div>

                    <div class="overall-feedback">
                        <h4>ì „ì²´ì ì¸ ë¶„ì„ì´ ì–¼ë§ˆë‚˜ ì •í™•í–ˆë‚˜ìš”?</h4>
                        <div class="rating-stars" id="overallRating">
                            <span class="star" data-rating="1">â˜…</span>
                            <span class="star" data-rating="2">â˜…</span>
                            <span class="star" data-rating="3">â˜…</span>
                            <span class="star" data-rating="4">â˜…</span>
                            <span class="star" data-rating="5">â˜…</span>
                        </div>
                        <button class="btn" onclick="submitAllFeedback()" style="margin-top: 15px;">
                            ğŸ§  í”¼ë“œë°± ì œì¶œí•˜ê¸°
                        </button>
                    </div>
                </div>

                <div style="text-align: center;">
                    <button class="btn reset-btn" onclick="resetAnalysis()">ğŸ”„ ë‹¤ë¥¸ ì‚¬ì§„ ë¶„ì„í•˜ê¸°</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // AI í•™ìŠµ ë°ì´í„° (ì‹¤ì œë¡œëŠ” ì„œë²„ DBì— ì €ì¥)
        let aiLearningData = {
            totalAnalyses: 0,
            feedbackCount: 0,
            colorAccuracy: 0.7,
            fitAccuracy: 0.62,
            trendAccuracy: 0.58,
            balanceAccuracy: 0.65,
            overallAccuracy: 0.64
        };

        // ğŸ”¹ ì „ì—­ ìƒíƒœ (ì¶”ê°€)
        let feedbackData = {};
        let selectedRating = 0;
        let currentAnalysis = null;

        // ğŸ”¹ ì´ˆê¸°í™” í•¨ìˆ˜ (ì¶”ê°€)
        function resetAnalysis() {
            // íŒŒì¼ ì…ë ¥ ë° ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸° ì´ˆê¸°í™”
            const fileInput = document.getElementById('fileInput');
            const previewImage = document.getElementById('previewImage');
            const uploadSection = document.getElementById('uploadSection');
            const previewSection = document.getElementById('previewSection');
            const analyzingSection = document.getElementById('analyzingSection');
            const resultsSection = document.getElementById('resultsSection');

            // íŒŒì¼/ì´ë¯¸ì§€ ë¦¬ì…‹
            if (fileInput) fileInput.value = '';
            if (previewImage) previewImage.src = '';

            // ìƒíƒœ ë¦¬ì…‹
            feedbackData = {};
            selectedRating = 0;
            currentAnalysis = null;
            window.currentImageFile = null; // í˜¹ì‹œ ëª¨ë¥¼ ì”ì—¬ ì°¸ì¡° ì œê±°

            // UI í‘œì‹œ ìƒíƒœ ë˜ëŒë¦¬ê¸°
            if (resultsSection) resultsSection.style.display = 'none';
            if (analyzingSection) analyzingSection.style.display = 'none';
            if (previewSection) previewSection.style.display = 'none';
            if (uploadSection) uploadSection.style.display = 'block';

            // ë²„íŠ¼/ë³„ì  UI ì´ˆê¸°í™”
            document.querySelectorAll('.feedback-btn').forEach(btn => btn.classList.remove('selected'));
            document.querySelectorAll('.star').forEach(star => star.classList.remove('selected'));

            // ë³„ì  ì´ë²¤íŠ¸ ì¬ë°”ì¸ë”©(ì•ˆì „)
            if (typeof initializeStarRating === 'function') {
                initializeStarRating();
            }

            // ë§¨ ìœ„ë¡œ ìŠ¤í¬ë¡¤
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // ì´ë¯¸ì§€ íŠ¹ì§• ì¶”ì¶œ í•¨ìˆ˜ë“¤ ì¶”ê°€
        async function extractImageFeatures(imageFile) {
            return new Promise((resolve) => {
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                const img = new Image();

                img.onload = () => {
                    // ì‘ì€ í¬ê¸°ë¡œ ë¦¬ì‚¬ì´ì¦ˆ (ìš©ëŸ‰ ì ˆì•½)
                    canvas.width = 100;
                    canvas.height = 100;
                    ctx.drawImage(img, 0, 0, 100, 100);

                    const imageData = ctx.getImageData(0, 0, 100, 100);
                    const features = {
                        colorHistogram: extractColorHistogram(imageData),
                        dominantColors: extractDominantColors(imageData, 5), // ìƒìœ„ 5ê°œ ìƒ‰ìƒë§Œ
                        brightness: calculateBrightness(imageData),
                        contrast: calculateContrast(imageData),
                        saturation: calculateSaturation(imageData)
                    };

                    resolve(features);
                };

                img.src = URL.createObjectURL(imageFile);
            });
        }

        function extractColorHistogram(imageData) {
            const data = imageData.data;
            const histogram = { r: new Array(16).fill(0), g: new Array(16).fill(0), b: new Array(16).fill(0) };

            // 16êµ¬ê°„ìœ¼ë¡œ ë‹¨ìˆœí™” (ìš©ëŸ‰ ì ˆì•½)
            for (let i = 0; i < data.length; i += 4) {
                const r = Math.floor(data[i] / 16);
                const g = Math.floor(data[i + 1] / 16);
                const b = Math.floor(data[i + 2] / 16);

                histogram.r[r]++;
                histogram.g[g]++;
                histogram.b[b]++;
            }

            return histogram;
        }

        function extractDominantColors(imageData, count = 5) {
            const data = imageData.data;
            const colorCounts = {};

            // 10í”½ì…€ë§ˆë‹¤ ìƒ˜í”Œë§ (ì„±ëŠ¥ ìµœì í™”)
            for (let i = 0; i < data.length; i += 40) { // 4 * 10
                const r = Math.floor(data[i] / 32) * 32;     // 8ë‹¨ê³„ë¡œ ì–‘ìí™”
                const g = Math.floor(data[i + 1] / 32) * 32;
                const b = Math.floor(data[i + 2] / 32) * 32;

                const colorKey = `${r},${g},${b}`;
                colorCounts[colorKey] = (colorCounts[colorKey] || 0) + 1;
            }

            return Object.entries(colorCounts)
                .sort(([, a], [, b]) => b - a)
                .slice(0, count)
                .map(([color, count]) => {
                    const [r, g, b] = color.split(',').map(Number);
                    return { r, g, b, count };
                });
        }

        function calculateBrightness(imageData) {
            const data = imageData.data;
            let total = 0;
            let count = 0;

            for (let i = 0; i < data.length; i += 4) {
                total += (data[i] * 0.299 + data[i + 1] * 0.587 + data[i + 2] * 0.114);
                count++;
            }

            return Math.round(total / count);
        }

        function calculateContrast(imageData) {
            const data = imageData.data;
            let min = 255, max = 0;

            for (let i = 0; i < data.length; i += 4) {
                const brightness = data[i] * 0.299 + data[i + 1] * 0.587 + data[i + 2] * 0.114;
                min = Math.min(min, brightness);
                max = Math.max(max, brightness);
            }

            return Math.round(max - min);
        }

        function calculateSaturation(imageData) {
            const data = imageData.data;
            let totalSat = 0;
            let count = 0;

            for (let i = 0; i < data.length; i += 4) {
                const r = data[i] / 255;
                const g = data[i + 1] / 255;
                const b = data[i + 2] / 255;

                const max = Math.max(r, g, b);
                const min = Math.min(r, g, b);
                const saturation = max === 0 ? 0 : (max - min) / max;

                totalSat += saturation;
                count++;
            }

            return Math.round((totalSat / count) * 100);
        }

        let currentImageFile = null;

        const uploadArea = document.getElementById('uploadArea');
        const fileInput = document.getElementById('fileInput');
        const previewSection = document.getElementById('previewSection');
        const previewImage = document.getElementById('previewImage');
        const analyzingSection = document.getElementById('analyzingSection');
        const resultsSection = document.getElementById('resultsSection');
        const uploadSection = document.getElementById('uploadSection');

        // ë“œë˜ê·¸ ì•¤ ë“œë¡­ ì´ë²¤íŠ¸
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        });

        uploadArea.addEventListener('dragleave', () => {
            uploadArea.classList.remove('dragover');
        });

        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                handleFile(files[0]);
            }
        });

        uploadArea.addEventListener('click', () => {
            fileInput.click();
        });

        fileInput.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                handleFile(e.target.files[0]);
            }
        });

        function handleFile(file) {
            if (file.type.startsWith('image/')) {
                currentImageFile = file; // ì´ë¯¸ì§€ íŒŒì¼ ì €ì¥
                const reader = new FileReader();
                reader.onload = (e) => {
                    previewImage.src = e.target.result;
                    uploadSection.style.display = 'none';
                    previewSection.style.display = 'block';
                };
                reader.readAsDataURL(file);
            } else {
                alert('ì´ë¯¸ì§€ íŒŒì¼ë§Œ ì—…ë¡œë“œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
            }
        }

        function startAnalysis() {
            previewSection.style.display = 'none';
            analyzingSection.style.display = 'block';

            const statusElement = document.getElementById('analysisStatus');
            const steps = [
                "ìƒ‰ìƒ íŒ¨í„´ ë¶„ì„ ì§„í–‰ ì¤‘...",
                "ê³¼ê±° í•™ìŠµ ë°ì´í„° ì ìš© ì¤‘...",
                "ìŠ¤íƒ€ì¼ ìš”ì†Œ ë§¤ì¹­ ì¤‘...",
                "AI ëª¨ë¸ ì˜ˆì¸¡ ì¤‘...",
                "ìµœì¢… ì ìˆ˜ ê³„ì‚° ì¤‘..."
            ];

            let stepIndex = 0;
            const progressInterval = setInterval(() => {
                if (stepIndex < steps.length) {
                    statusElement.textContent = steps[stepIndex];
                    stepIndex++;
                } else {
                    clearInterval(progressInterval);
                }
            }, 1000);

            setTimeout(() => {
                performAnalysis();
            }, 5500);
        }

        function performAnalysis() {
            // AI í•™ìŠµ ë°ì´í„° ê¸°ë°˜ ì ìˆ˜ ìƒì„±
            currentAnalysis = generateScores();

            // ë¶„ì„ íšŸìˆ˜ ì¦ê°€ (ì¡°ìš©íˆ)
            aiLearningData.totalAnalyses++;

            displayResults(currentAnalysis);
        }

        function generateScores() {
            // AI ì •í™•ë„ì— ë”°ë¼ ì ìˆ˜ ë²”ìœ„ ì¡°ì •
            const baseAccuracy = aiLearningData.overallAccuracy;
            const variance = Math.max(5, 30 - (baseAccuracy * 40)); // í•™ìŠµë ìˆ˜ë¡ í¸ì°¨ ê°ì†Œ

            // ê³¼ê±° í”¼ë“œë°± ë°ì´í„° ë°˜ì˜
            const colorBias = aiLearningData.colorAccuracy > 0.8 ? 5 : -3;
            const fitBias = aiLearningData.fitAccuracy > 0.8 ? 5 : -3;
            const trendBias = aiLearningData.trendAccuracy > 0.8 ? 5 : -3;
            const balanceBias = aiLearningData.balanceAccuracy > 0.8 ? 5 : -3;

            const colorScore = Math.max(40, Math.min(99,
                Math.floor(Math.random() * variance) + 70 + colorBias
            ));
            const fitScore = Math.max(40, Math.min(99,
                Math.floor(Math.random() * variance) + 70 + fitBias
            ));
            const trendScore = Math.max(40, Math.min(99,
                Math.floor(Math.random() * variance) + 70 + trendBias
            ));
            const balanceScore = Math.max(40, Math.min(99,
                Math.floor(Math.random() * variance) + 70 + balanceBias
            ));

            const totalScore = Math.round((colorScore + fitScore + trendScore + balanceScore) / 4);

            return {
                color: colorScore,
                fit: fitScore,
                trend: trendScore,
                balance: balanceScore,
                total: totalScore
            };
        }

        function displayResults(analysis) {
            // ì ìˆ˜ í‘œì‹œ
            document.getElementById('totalScore').textContent = analysis.total;
            document.getElementById('colorScore').textContent = analysis.color;
            document.getElementById('fitScore').textContent = analysis.fit;
            document.getElementById('trendScore').textContent = analysis.trend;
            document.getElementById('balanceScore').textContent = analysis.balance;

            // í”¼ë“œë°± ì„¹ì…˜ ì ìˆ˜ ë™ê¸°í™”
            document.getElementById('feedbackColorScore').textContent = analysis.color;
            document.getElementById('feedbackFitScore').textContent = analysis.fit;
            document.getElementById('feedbackTrendScore').textContent = analysis.trend;
            document.getElementById('feedbackBalanceScore').textContent = analysis.balance;

            // ë¶„ì„ í…ìŠ¤íŠ¸ ìƒì„±
            updateAnalysisTexts(analysis);

            // í”¼ë“œë°± ë²„íŠ¼ ì´ˆê¸°í™”
            resetFeedbackButtons();

            // ë³„ì  ì´ë²¤íŠ¸ ë‹¤ì‹œ ì—°ê²° (ì¤‘ìš”!)
            setTimeout(() => {
                initializeStarRating();
            }, 100);

            analyzingSection.style.display = 'none';
            resultsSection.style.display = 'block';
        }

        function updateAnalysisTexts(analysis) {
            document.getElementById('colorAnalysis').textContent =
                `AIê°€ ìƒ‰ìƒ íŒ¨í„´ì„ ë¶„ì„í•œ ê²°ê³¼ ${analysis.color}ì ì…ë‹ˆë‹¤. ${analysis.color >= 85 ? 'ë§¤ìš° ì¡°í™”ë¡œìš´' : analysis.color >= 75 ? 'ì ì ˆí•œ' : 'ê°œì„ ì´ í•„ìš”í•œ'} ìƒ‰ìƒ ì¡°í•©ìœ¼ë¡œ íŒë‹¨ë©ë‹ˆë‹¤.`;

            document.getElementById('fitAnalysis').textContent =
                `ì²´í˜• ë¶„ì„ ëª¨ë¸ì´ ${analysis.fit}ì ìœ¼ë¡œ í‰ê°€í–ˆìŠµë‹ˆë‹¤. ${analysis.fit >= 85 ? 'ì™„ë²½í•œ í•' : analysis.fit >= 75 ? 'ì¢‹ì€ í•' : 'í• ê°œì„  í•„ìš”'}ìœ¼ë¡œ ë¶„ì„ë˜ì—ˆìŠµë‹ˆë‹¤.`;

            document.getElementById('trendAnalysis').textContent =
                `íŠ¸ë Œë“œ ë°ì´í„°ë² ì´ìŠ¤ ë§¤ì¹­ ê²°ê³¼ ${analysis.trend}ì ì…ë‹ˆë‹¤. ${analysis.trend >= 85 ? 'ìµœì‹  íŠ¸ë Œë“œë¥¼ ì™„ë²½íˆ ë°˜ì˜' : analysis.trend >= 75 ? 'íŠ¸ë Œë“œë¥¼ ì˜ ë°˜ì˜' : 'íŠ¸ë Œë“œ ì—…ë°ì´íŠ¸ í•„ìš”'}í•œ ìŠ¤íƒ€ì¼ì…ë‹ˆë‹¤.`;

            document.getElementById('balanceAnalysis').textContent =
                `ì „ì²´ ê· í˜• ì•Œê³ ë¦¬ì¦˜ì´ ${analysis.balance}ì ìœ¼ë¡œ ë¶„ì„í–ˆìŠµë‹ˆë‹¤. ${analysis.balance >= 85 ? 'ì™„ë²½í•œ ê· í˜•ê°' : analysis.balance >= 75 ? 'ì¢‹ì€ ê· í˜•ê°' : 'ê· í˜• ì¡°ì • í•„ìš”'}ì„ ë³´ì—¬ì¤ë‹ˆë‹¤.`;
        }

        // í”¼ë“œë°± ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì´ˆê¸°í™”
        function initializeFeedbackButtons() {
            document.querySelectorAll('.feedback-btn').forEach(button => {
                button.addEventListener('click', function () {
                    const category = this.dataset.category;
                    const feedback = this.dataset.feedback;

                    // ê°™ì€ ì¹´í…Œê³ ë¦¬ì˜ ë‹¤ë¥¸ ë²„íŠ¼ë“¤ ë¹„í™œì„±í™”
                    const categoryButtons = document.querySelectorAll(`[data-category="${category}"]`);
                    categoryButtons.forEach(btn => {
                        btn.classList.remove('selected');
                    });

                    // ì„ íƒëœ ë²„íŠ¼ í™œì„±í™”
                    this.classList.add('selected');

                    // í”¼ë“œë°± ë°ì´í„° ì €ì¥
                    feedbackData[category] = feedback;
                });
            });
        }

        // ë³„ì  ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì´ˆê¸°í™” (ì´ë²¤íŠ¸ ìœ„ì„ ë°©ì‹ ì‚¬ìš©)
        function initializeStarRating() {
            const ratingContainer = document.getElementById('overallRating');

            // ê¸°ì¡´ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì œê±°ë¥¼ ìœ„í•´ ìƒˆë¡œìš´ ì»¨í…Œì´ë„ˆë¡œ êµì²´
            const newRatingContainer = ratingContainer.cloneNode(true);
            ratingContainer.parentNode.replaceChild(newRatingContainer, ratingContainer);

            // ì´ë²¤íŠ¸ ìœ„ì„ìœ¼ë¡œ ë³„ì  í´ë¦­ ì²˜ë¦¬
            newRatingContainer.addEventListener('click', function (e) {
                if (e.target.classList.contains('star')) {
                    selectedRating = parseInt(e.target.dataset.rating);
                    updateStarDisplay();
                    console.log('ë³„ì  ì„ íƒ:', selectedRating); // ë””ë²„ê¹…ìš©
                }
            });

            // ë§ˆìš°ìŠ¤ í˜¸ë²„ íš¨ê³¼
            newRatingContainer.addEventListener('mouseover', function (e) {
                if (e.target.classList.contains('star')) {
                    const rating = parseInt(e.target.dataset.rating);
                    const stars = newRatingContainer.querySelectorAll('.star');
                    stars.forEach((star, index) => {
                        if (index < rating) {
                            star.classList.add('selected');
                        } else {
                            star.classList.remove('selected');
                        }
                    });
                }
            });

            // ë§ˆìš°ìŠ¤ ì•„ì›ƒì‹œ ì›ë˜ ìƒíƒœë¡œ
            newRatingContainer.addEventListener('mouseout', function () {
                updateStarDisplay();
            });
        }

        function resetFeedbackButtons() {
            feedbackData = {};
            selectedRating = 0;
            document.querySelectorAll('.feedback-btn').forEach(button => {
                button.classList.remove('selected');
            });

            // ë³„ì  ì´ˆê¸°í™” - ëª¨ë“  ë³„ì„ íšŒìƒ‰ìœ¼ë¡œ
            document.querySelectorAll('.star').forEach(star => {
                star.classList.remove('selected');
            });

            console.log('í”¼ë“œë°± ì´ˆê¸°í™” ì™„ë£Œ'); // ë””ë²„ê¹…ìš©
        }

        function updateStarDisplay() {
            const stars = document.querySelectorAll('#overallRating .star');
            console.log('ì´ ë³„ ê°œìˆ˜:', stars.length, 'ì„ íƒëœ ë³„ì :', selectedRating); // ë””ë²„ê¹…

            stars.forEach((star, index) => {
                if (index < selectedRating) {
                    star.classList.add('selected');
                    console.log(`ë³„ ${index + 1}: ì„ íƒë¨ (ë…¸ë€ìƒ‰)`); // ë””ë²„ê¹…
                } else {
                    star.classList.remove('selected');
                    console.log(`ë³„ ${index + 1}: ì„ íƒ ì•ˆë¨ (íšŒìƒ‰)`); // ë””ë²„ê¹…
                }
            });
        }

        // ëª¨ë“  í”¼ë“œë°± ì œì¶œ
        async function submitAllFeedback() {
            if (Object.keys(feedbackData).length < 4) {
                alert('ëª¨ë“  ì¹´í…Œê³ ë¦¬ì— ëŒ€í•œ í”¼ë“œë°±ì„ ì„ íƒí•´ì£¼ì„¸ìš”!');
                return;
            }

            if (selectedRating === 0) {
                alert('ì „ì²´ í‰ê°€ ë³„ì ì„ ì„ íƒí•´ì£¼ì„¸ìš”!');
                return;
            }

            // AI í•™ìŠµ ì§„í–‰ (ì¡°ìš©íˆ)
            Object.keys(feedbackData).forEach(category => {
                const feedback = feedbackData[category];
                updateAIAccuracy(category, feedback);
            });

            // ì „ì²´ í‰ê°€ ë°˜ì˜
            const ratingScore = selectedRating / 5;
            aiLearningData.overallAccuracy = aiLearningData.overallAccuracy * 0.9 + ratingScore * 0.1;

            // ëª¨ë“  ì¹´í…Œê³ ë¦¬ì— ë³„ì  ì˜í–¥ ë°˜ì˜
            if (selectedRating >= 4) {
                ['color', 'fit', 'trend', 'balance'].forEach(category => {
                    aiLearningData[category + 'Accuracy'] = Math.min(0.95, aiLearningData[category + 'Accuracy'] + 0.02);
                });
            } else if (selectedRating <= 2) {
                ['color', 'fit', 'trend', 'balance'].forEach(category => {
                    aiLearningData[category + 'Accuracy'] = Math.max(0.3, aiLearningData[category + 'Accuracy'] - 0.02);
                });
            }

            aiLearningData.feedbackCount++;

            // ì´ë¯¸ì§€ íŠ¹ì§• ì¶”ì¶œ ë° ì„œë²„ ì „ì†¡ (ë°±ê·¸ë¼ìš´ë“œì—ì„œ)
            if (currentImageFile) {
                extractAndSendTrainingData().catch(error => {
                    console.error('í•™ìŠµ ë°ì´í„° ì „ì†¡ ì‹¤íŒ¨:', error);
                    // ì‹¤íŒ¨í•´ë„ ì‚¬ìš©ì ê²½í—˜ì—ëŠ” ì˜í–¥ ì—†ìŒ
                });
            }

            // ì„±ê³µ ë©”ì‹œì§€ì™€ í•¨ê»˜ ì²˜ìŒ í™”ë©´ìœ¼ë¡œ ëŒì•„ê°€ê¸°
            alert('ğŸ§  í”¼ë“œë°±ì´ ì œì¶œë˜ì—ˆìŠµë‹ˆë‹¤!\nAIê°€ ì¡°ìš©íˆ í•™ìŠµí•˜ì—¬ ë” ì •í™•í•´ì¡ŒìŠµë‹ˆë‹¤.');

            // ì¦‰ì‹œ ì²˜ìŒ í™”ë©´ìœ¼ë¡œ ëŒì•„ê°€ê¸°
            resetAnalysis();
        }

        function updateAIAccuracy(category, feedback) {
            const currentAccuracy = aiLearningData[category + 'Accuracy'];
            const learningRate = 0.1;

            if (feedback === 'accurate') {
                // ì •í™•í•˜ë‹¤ê³  í‰ê°€ë°›ìœ¼ë©´ ì •í™•ë„ ì†Œí­ ìƒìŠ¹
                aiLearningData[category + 'Accuracy'] = Math.min(0.95, currentAccuracy + learningRate * 0.5);
            } else if (feedback === 'high') {
                // ì ìˆ˜ê°€ ë†’ë‹¤ê³  í•˜ë©´ ë” ë³´ìˆ˜ì ìœ¼ë¡œ ì ìˆ˜ ì‚°ì •í•˜ë„ë¡ í•™ìŠµ
                aiLearningData[category + 'Accuracy'] = Math.min(0.95, currentAccuracy + learningRate * 0.3);
            } else if (feedback === 'low') {
                // ì ìˆ˜ê°€ ë‚®ë‹¤ê³  í•˜ë©´ ë” ê´€ëŒ€í•˜ê²Œ ì ìˆ˜ ì‚°ì •í•˜ë„ë¡ í•™ìŠµ
                aiLearningData[category + 'Accuracy'] = Math.min(0.95, currentAccuracy + learningRate * 0.3);
            }
        }

        // í•™ìŠµ ë°ì´í„° ì¶”ì¶œ ë° ì„œë²„ ì „ì†¡ (ë°±ì—”ë“œ ë¯¸ì—°ê²°ì‹œì—ë„ ì•ˆì „)
        async function extractAndSendTrainingData() {
            try {
                console.log('ğŸ”¬ ì´ë¯¸ì§€ íŠ¹ì§• ì¶”ì¶œ ì‹œì‘...');
                const features = await extractImageFeatures(currentImageFile);

                const trainingData = {
                    timestamp: new Date().toISOString(),
                    imageFeatures: features,
                    aiPredictions: {
                        color: currentAnalysis.color,
                        fit: currentAnalysis.fit,
                        trend: currentAnalysis.trend,
                        balance: currentAnalysis.balance,
                        total: currentAnalysis.total
                    },
                    userFeedback: {
                        color: feedbackData.color,
                        fit: feedbackData.fit,
                        trend: feedbackData.trend,
                        balance: feedbackData.balance
                    },
                    userRating: selectedRating,
                    sessionId: generateSessionId()
                };

                console.log('ğŸ“Š ì¶”ì¶œëœ íŠ¹ì§•:', features);
                console.log('ğŸ“¦ í•™ìŠµ ë°ì´í„°:', trainingData);

                // ë°±ì—”ë“œê°€ ì—°ê²°ë˜ì–´ ìˆì„ ë•Œë§Œ ì„œë²„ë¡œ ì „ì†¡
                try {
                    const response = await fetch('/api/collect-training-data', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(trainingData)
                    });

                    if (response.ok) {
                        console.log('âœ… í•™ìŠµ ë°ì´í„° ì„œë²„ ì „ì†¡ ì™„ë£Œ');
                    } else {
                        console.log('âš ï¸ ì„œë²„ ì‘ë‹µ ì˜¤ë¥˜:', response.status);
                        console.log('ğŸ’¾ ë¡œì»¬ì—ì„œ í•™ìŠµ ë°ì´í„° ì‹œë®¬ë ˆì´ì…˜');
                    }
                } catch (networkError) {
                    console.log('âš ï¸ ì„œë²„ ë¯¸ì—°ê²° - ë¡œì»¬ ì‹œë®¬ë ˆì´ì…˜ ëª¨ë“œ');
                    console.log('ğŸ’¾ í•™ìŠµ ë°ì´í„°ê°€ ì¶”ì¶œë˜ì–´ ì¤€ë¹„ë˜ì—ˆìŠµë‹ˆë‹¤');
                    // ì‹¤ì œ ì„œë¹„ìŠ¤ì—ì„œëŠ” ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ë‚˜ IndexedDBì— ì„ì‹œ ì €ì¥ ê°€ëŠ¥
                }

            } catch (error) {
                console.error('âŒ íŠ¹ì§• ì¶”ì¶œ ì‹¤íŒ¨:', error);
            }
        }

        // ìµëª… ì„¸ì…˜ ID ìƒì„±
        function generateSessionId() {
            return 'session_' + Math.random().toString(36).substr(2, 9) + '_' + Date.now();
        }

        // ì´ˆê¸°í™”
        initializeFeedbackButtons();
        initializeStarRating();
    </script>
</body>

</html>